const mixxoPost=function(e){let t,o,n,i,r,m,s,p,a="33.33%";e.init=function(e){t=e.appId,o=e.appKey,n=void 0===e.adminNick?"admin":e.adminNick,i=void 0===e.page?15:e.page,void 0===e.flexDirection?m="row":(m=e.flexDirection,a=""),r=void 0===e.frameWidth?"100%":e.frameWidth,s=void 0===e.gravatarCDN?"//www.gravatar.com/avatar/":e.gravatarCDN,p=void 0===e.md5CDN?"//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js":e.md5CDN,d(),l()};let d=()=>{let e=`<style>.transform-hidden{transition:transform 0s!important;transform:none!important;} #mixxopost .mixxo-post-reply{border-radius:.1rem;z-index:2;max-width:80vw;position:fixed;left:0;top:0;margin-top:20vh;border:0;margin-left:calc((100vw - 80vw)/ 2);box-shadow:0 0 15px 0 rgba(0,0,0,.36);transition:width .2s,height .2s}.mp-overlay{z-index:1;background-color:rgba(0,0,0,.7);position:fixed;top:0;left:0;height:100%;width:100%}section.mixxo-post{width:100%;background:#fff;border:1px solid #ededed;transition:box-shadow .3s;overflow:hidden}#mixxopost{margin-bottom:40px;max-width:${r};width:100%}#mixxopost>section.mixxo-post>.mp-reply-tips{display:none;color:#5a5a5a;padding:.2rem;margin-bottom:0;background-color:#f8f8f8}#mixxopost>section.mixxo-post>.mp-reply-tips .mpr-footer{display:none}#mixxopost>section.mixxo-post>section.mixxo-user-info{display:flex;flex-direction:column;border-bottom:1px dashed #ededed;overflow:hidden}#mixxopost>section.mixxo-post>section.mixxo-user-info>div{box-sizing:border-box;;height:56px;padding:10px 20px}#mixxopost>section.mixxo-post>section.mixxo-comments #mp-comment{z-index:1;position:relative;padding:20px;background:0 0;border:0;color:#262626;font-size:.14rem;min-height:48px;height:auto;outline:0;resize:none;overflow:auto;word-wrap:break-word;transition:min-height .3s}#mixxopost>section.mixxo-post>section.mixxo-comments #mp-comment::before{cursor:text;color:#e2e2e2;content:attr(data-placeholder);display:block}#mixxopost>section.mixxo-post>section.mixxo-comments label{color:#8c8c8c;margin-top:10px;font-size:.12rem;position:absolute;padding:0 20px}#mixxopost>section.mixxo-post>section.mixxo-comments label span{color:#cbcbcb}#mixxopost>section.mixxo-post>section.mixxo-footer{text-align:right}@media screen and (min-width:800px){#mixxopost .mixxo-post-reply{max-width:60vw;margin-left:calc((100vw - 60vw)/ 2)}}@media screen and (min-width:600px){#mixxopost>section.mixxo-post>section.mixxo-user-info{flex-direction:${m}}#mixxopost>section.mixxo-post>section.mixxo-user-info>div{width:${a}}}.mixxo-user-comments>#mp-post-lists{padding-left:0}.mixxo-user-comments>#mp-post-lists>.mp-post-li{display:flex;flex-direction:column}.mixxo-user-comments #mp-comments-panel{display:flex;align-items:center;margin:.3rem 0;font-weight:700;justify-content:space-between}.mixxo-user-comments #mp-comments-panel #mp-comments-num{font-size:16px;}.mixxo-user-comments #mp-comments-panel #mp-comments-num span{margin-right:.1rem}.mixxo-user-comments #mp-comments-panel .mp-admin-panel{overflow:hidden;border:1px solid #e8e8e8;background-color:#f7f7f7;font-size:.14rem;font-weight:400;height:30px;width:30px;border-radius:1rem;color:#a4a4a4;transition:border .2s,width .2s,color .2s,background-color .2s}.mixxo-user-comments #mp-comments-panel .mp-admin-panel:hover{background-color:#50d396;color:#fff;border:1px solid #32b879;width:86px}.mixxo-user-comments #mp-comments-panel .mp-admin-panel>span{display:block;width:86px;margin-top:.04rem;margin-left:.06rem}.mp-reply{list-style:none;margin-left:.14rem}.mp-delete-confirm,.mp-post-body,.mp-reply-tips{display:flex;flex-direction:row;margin-bottom:.2rem}.mp-delete-confirm .headimg,.mp-post-body .headimg,.mp-reply-tips .headimg{display:block;min-width:40px;min-height:40px;max-width:40px;max-height:40px;background-color:#ee5e5e;border-radius:10rem;margin-right:.2rem;background-size:cover}.mp-delete-confirm div .mpr-header,.mp-post-body div .mpr-header,.mp-reply-tips div .mpr-header{margin-bottom:.05rem}.mp-delete-confirm div .mpr-header .mpr-nick,.mp-post-body div .mpr-header .mpr-nick,.mp-reply-tips div .mpr-header .mpr-nick{font-weight:600}.mp-delete-confirm div .mpr-header .mpr-nick .mp-writer,.mp-post-body div .mpr-header .mpr-nick .mp-writer,.mp-reply-tips div .mpr-header .mpr-nick .mp-writer{padding:0 6px 2px;border-radius:.9rem;font-size:.12rem;margin:0 8px;background-color:#fcab1d;color:#fff}.mp-delete-confirm div .mpr-header .mpr-date,.mp-post-body div .mpr-header .mpr-date,.mp-reply-tips div .mpr-header .mpr-date{padding-left:.1rem;font-weight:lighter;font-size:.14rem;color:#878787}.mp-delete-confirm div .mpr-body,.mp-post-body div .mpr-body,.mp-reply-tips div .mpr-body{font-size:.14rem}.mp-delete-confirm div .mpr-body span,.mp-post-body div .mpr-body span,.mp-reply-tips div .mpr-body span{color:#9c9c9c}.mp-delete-confirm div .mpr-footer,.mp-post-body div .mpr-footer,.mp-reply-tips div .mpr-footer{color:#b7b7b7;font-size:.14rem;font-weight:lighter;margin:.05rem 0}.mp-delete-confirm div .mpr-footer span:hover,.mp-post-body div .mpr-footer span:hover,.mp-reply-tips div .mpr-footer span:hover{color:#19b997}.mp-delete-confirm div .mpr-footer .mpr-delete,.mp-post-body div .mpr-footer .mpr-delete,.mp-reply-tips div .mpr-footer .mpr-delete{display:none;margin-left:.1rem}.mp-delete-confirm div .mpr-footer .mpr-delete:hover,.mp-post-body div .mpr-footer .mpr-delete:hover,.mp-reply-tips div .mpr-footer .mpr-delete:hover{color:#b91919}.mp-delete-confirm{width:50vw;padding:.2rem;position:fixed;top:20vh;display:none;left:0;z-index:2;border-radius:.1rem;background-color:#fff;margin-left:calc((100vw - 50vw)/ 2)}.mp-delete-confirm div{width:100%}.mp-delete-confirm div .mpr-footer>div{text-align:right;font-weight:700;margin-top:.3rem}.mp-delete-confirm div .mpr-footer>div span.mpr-cancel{margin-right:.1rem}.mp-delete-confirm div .mpr-footer>div span.mpr-delete{margin-left:0;background-color:#fa2959;color:#ffffffeb;padding:.06rem .1rem;border-radius:1rem}.mp-delete-confirm div .mpr-footer>div span.mpr-delete:hover{color:#ffffffeb;background-color:#be2549}.mp-comment-minHeight{min-height:64px!important}.mp-label-trans{transform:scale(.8) translateY(-10px)}.mp-ui-pt{padding-top:10px}.mp-label{line-height:36px;color:#999;font-size:.14rem;position:absolute;transform-origin:left;transition:transform .2s;cursor:text}.mp-info{height:36px;outline:0;border:0;width:100%;transition:padding .2s}#mp-post{width:80px;height:36px;background-color:#000;color:#fff;border:0;outline:0}#mp-post:hover{background-color:#32b879;transition:background-color .1s}@keyframes mpSuccesstTip{0%{transform:translateY(0)}50%{transform:translateY(-1rem)}99%{transform:translateY(.6rem)}}.mp-success{display:none}.mp-success-tips{display:flex;animation-duration:1.4s;animation-name:mpSuccesstTip;animation-timing-function:ease-in-out;align-items:center;justify-content:center;color:#fff;z-index:999;border-radius:.5rem;left:calc((100vw - 20vw)/ 2);bottom:-.8rem;position:fixed;height:60px;width:20vw;background-color:#000000be}.mp-next-hidden{display:none}#mp-next-page{text-align:center;border:1px solid #ececec;padding:.08rem;color:#b0b0b0;border-radius:.06rem}#mp-next-page:hover{background-color:#fcfcfc}</style>`;document.querySelector("head").insertAdjacentHTML("beforeend",e),document.querySelector("#mixxopost").insertAdjacentHTML("afterbegin",'<section class="mixxo-post" type="comment">\n    <span class="mp-reply-tips"></span>   \n        <section class="mixxo-user-info">\n            <div>\n                <label class="mp-label" for="mp-nick">昵称</label>\n                <input id="mp-nick" class="mp-info" name="name" autocomplete="off" type="text">\n            </div>\n            <div>\n                <label class="mp-label" for="mp-mail">邮箱</label>\n                <input id="mp-mail" class="mp-info" name="mail" autocomplete="off" type="text">\n            </div>\n            <div>\n                <label class="mp-label" for="mp-website">网站</label>\n                <input id="mp-website" class="mp-info" name="website" autocomplete="off" type="text">\n            </div>\n        </section>\n        <section class="mixxo-comments">\n                <div data-placeholder="" contenteditable="true" id="mp-comment"></div>\n                <label for="mp-comment"><span></span></label>\n        </section>\n        <section class="mixxo-footer">\n        <button type="button" id="mp-post">回复</button>\n        </section>\n    </section>\n    <div class="mixxo-user-comments">\n            <div id="mp-comments-panel"><div id="mp-comments-num"><span></span>Comments</div></div>\n            <ul id="mp-post-lists" page="0"></ul>\n            <div id="mp-next-page" class="mp-next-hidden">next</div>\n    </div>\n    <span class="mp-delete-confirm"></span>\n    <div id="mp-success-tips" class="mp-success">回复成功</div>\n    <div id="mp-overlay"></div>\n    ')},l=()=>{if(!AV.applicationId){var{Query:e,User:r}=AV;AV.init(t,o)}let m=()=>{AV.Cloud.run("run").then(function(e){console.log("EmailNoticEngine:run")},function(e){})};const p=function(e){return document.querySelector(e)},a=(e,t)=>{Array.prototype.map.call(e,e=>e.style=t)},d=e=>{const t=document.querySelectorAll(".mpr-delete");e?a(t,"display:inline-block"):a(t,"")};var l=AV.Object.extend("Todo");let c=function(e,t,o,n,i,r,m,s){var a=new l;a.set("usernick",e),a.set("mail",t),a.set("website",o),a.set("comments",n),a.set("url",i),a.set("headImgID",r),a.save().then(function(e){let t=e.attributes;p("#mp-post-lists").insertAdjacentHTML("afterbegin",b(Date.parse(e.createdAt),t.usernick,g(t.usernick),e.id,e.id,"",t.comments,t.usernick,e.className,t.headImgID,u.deleteControl()))},function(e){})};var x=AV.Object.extend("Floor");let f=function(e,t,o,n,i,r,m,s,p){var a=new x;a.set("usernick",e),a.set("mail",t),a.set("website",o),a.set("comments",n),a.set("parentId",i),a.set("url",encodeURI(decodeURI(window.location.pathname))),a.set("headImgID",r),a.set("re",m),a.save().then(function(e){let t=AV.Object.createWithoutData("Todo",i);t.set("hasReply",!0),t.save();let o=e.attributes;document.getElementById(o.parentId).insertAdjacentHTML("beforeend",b(Date.parse(e.createdAt),o.usernick,g(o.usernick),o.parentId,e.id,o.re,o.comments,o.usernick,e.className,o.headImgID,u.deleteControl()))},function(e){})};const u={getCurrentUser:function(){return!!AV.User.current()},deleteControl:function(){return 1==this.getCurrentUser()?"delete":""},init:function(){!0===this.getCurrentUser()&&(p("#mp-comments-panel").innerHTML+='\n                 <div class="mp-admin-panel">\n                 <span>🔑 Logout</span>\n                 </div>',p("#mp-comments-panel").addEventListener("click",e=>{console.log("退出登录"),AV.User.logOut(),p("#mp-comments-panel").removeChild(p(".mp-admin-panel")),d(!1)}))}},g=function(e){return e===n?'<span class="mp-writer">writer</span>':""};let b=function(e,t,o,n,i,r,m,p,a,d,l){let c=`<ul class="mp-reply" id="${n}"></ul>`;return`<li class="mp-post-li"><div class="mp-post-body">\n                                    <div class="headimg" style="background-image:url('${s+d}')"></div>\n                                    <div>\n                                    <div class="mpr-header" data-date="${e}">\n                                        <span class="mpr-nick">${t}${o}</span>\n                                        <span class="mpr-date">${function(e){let t=new Date(e),o=Date.now()-e;return o<6e4?parseInt(o/1e3)+"秒前":o<36e5?parseInt(o/6e4)+"分钟前":o<864e5?parseInt(o/36e5)+"小时":o<1728e5?"昨天 "+t.getHours()+":"+t.getMinutes():t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDay()+"日"}(e)}<span>\n                                    </div>\n                                    <div class="mpr-body" ><span>${r} </span>${m}</div>\n                                    <div class="mpr-footer">\n                                    <div parent-id="${n}" obj-id="${i}">\n                                    <span class="mpr-reply"  at="${p}">reply</span>\n                                    <span class="mpr-delete" class-name="${a}">${l}</span>\n                                    </div>\n                                    </div>\n                                    </div>\n                                    </div>\n                                    ${c}\n                                    </li>`};const v=function(e){let t=new AV.Query("Floor");t.contains("parentId",e),t.find().then(t=>{for(let o of t){let t=o.attributes;document.getElementById(e.toString()).innerHTML+=`\n                ${b(Date.parse(o.createdAt),t.usernick,g(t.usernick),e,o.id,t.re,t.comments,t.usernick,o.className,t.headImgID,u.deleteControl())}\n                `}d(!0)})};!function(e){e.addEventListener("click",e=>{w(window.location.pathname)})}(p("#mp-next-page"));var h=new AV.Query("Todo");!function(e){h.equalTo("url",e),h.count().then(e=>{p("#mp-comments-num > span").innerText=e})}(window.location.pathname);var y=new AV.Query("Todo");const w=function(e){let t=p("#mp-post-lists").getAttribute("page");y.contains("url",e),y.descending("createdAt"),y.limit(i),y.skip(t*i),y.find().then(e=>{p("#mp-post-lists").setAttribute("page",Number(t)+1),p("#mp-post-lists").addEventListener("click",e=>{let t=e.target.parentNode.getAttribute("parent-id"),o=p(".mixxo-post"),n=p("#mixxopost");if("mpr-reply"===e.target.className){let i=e.target.getAttribute("at"),r=""!==i?"@"+i:"";n.parentNode.classList.add("transform-hidden"),o.setAttribute("parent-id",t),o.setAttribute("re",r),o.setAttribute("type","reply"),o.classList.add("mixxo-post-reply"),p("#mp-overlay").classList.add("mp-overlay"),p(".mp-reply-tips").style.display="flex",p(".mp-reply-tips").innerHTML=e.target.parentNode.parentNode.parentNode.parentNode.innerHTML}"mpr-delete"===e.target.className&&(o.classList.add("mixxo-post-delete"),n.parentNode.classList.add("transform-hidden"),p(".mp-delete-confirm").insertAdjacentHTML("beforeend",e.target.parentNode.parentNode.parentNode.parentNode.innerHTML.replace(/mpr\-reply/g,"mpr-cancel").replace(/reply/g,"cancel")),p(".mp-delete-confirm").style.display="flex",p("#mp-overlay").classList.add("mp-overlay"),p(".mp-delete-confirm").addEventListener("click",e=>{let t=e.target.className;if("mpr-delete"===t){let t=e.target.getAttribute("class-name"),o=e.target.parentNode.getAttribute("obj-id"),n=document.getElementById(e.target.parentNode.getAttribute("parent-id")).parentNode;AV.Object.createWithoutData(t,o).destroy().then(function(e){console.log("delete"),p(".mp-overlay").click(),n.remove()},function(e){})}else"mpr-cancel"===t&&p(".mp-overlay").click()}))}),p("#mp-overlay").addEventListener("click",e=>{p("#mixxopost").parentNode.classList.remove("transform-hidden"),p(".mixxo-post").setAttribute("type","comment"),p(".mixxo-post").classList.remove("mixxo-post-reply"),p("#mp-overlay").classList.remove("mp-overlay"),p(".mp-delete-confirm").style.display="",p(".mp-delete-confirm").innerHTML="",p(".mp-reply-tips").style.display="",p(".mp-reply-tips").innerHTML=""}),e.length>=i?p("#mp-next-page").classList.remove("mp-next-hidden"):p("#mp-next-page").classList.add("mp-next-hidden");for(let t of e){let e=t.attributes,o=`${b(Date.parse(t.createdAt),e.usernick,g(e.usernick),t.id,t.id,"",e.comments,"",t.className,e.headImgID,u.deleteControl())}`;p("#mp-post-lists").insertAdjacentHTML("beforeend",o),e.hasReply&&v(t.id)}d(!0)}).catch(e=>{console.log("拉取评论失败")})},k=()=>{let e=document.querySelectorAll(".mp-info");Array.prototype.map.call(e,e=>{e.target;""!==e.value&&(e.parentNode.children[0].classList.add("mp-label-trans"),e.classList.add("mp-ui-pt"))})};!function(){function e(e,t){let o=document.getElementById(t);switch(e){case!0:o.parentNode.children[0].classList.add("mp-label-trans"),o.classList.add("mp-ui-pt");break;default:o.parentNode.children[0].classList.remove("mp-label-trans"),o.classList.remove("mp-ui-pt")}}u.init(),w(encodeURI(decodeURI(window.location.pathname))),function(){let e=JSON.parse(localStorage.getItem("mixxoPostCache"));null!=e&&(p("#mp-nick").value=e.nick,p("#mp-mail").value=e.mail,p("#mp-website").value=e.website,k())}(),p(".mixxo-user-info").addEventListener("input",t=>{let o=t.target;o.value.length>0?e(!0,o.id):e(!1,o.id)}),p("#mp-comment").addEventListener("focusin",e=>{e.target.classList.add("mp-comment-minHeight")}),p("#mp-comment").addEventListener("blur",e=>{e.target.classList.remove("mp-comment-minHeight")});let t=()=>{p("#mp-comment").setAttribute("data-placeholder","留言..."),p("#mp-comment").innerHTML="",p("#mp-comment + label > span").innerText=2e3};t(),p("#mp-comment").addEventListener("input",e=>{if(e.target.parentNode.children[1].children[0].innerText=2e3-e.target.innerText.length,/\r\n|\n|\r/.test(e.target.innerText)?t():e.target.setAttribute("data-placeholder",""),e.target.innerText.length>2e3){let t=e.target.innerText;t.slice(0,2e3),t.slice(2e3)}});p("#mp-success-tips").addEventListener("animationend",e=>{p("#mp-success-tips").classList.remove("mp-success-tips")},!1);let o=window.location.pathname;p("#mp-post").addEventListener("click",e=>{function t(){switch(p(".mixxo-post").getAttribute("type")){case"reply":let e=p(".mixxo-post").getAttribute("parent-id"),t=p(".mixxo-post").getAttribute("re");f(i,r,s,a,e,md5(r),t,x());break;case"comment":c(i,r,s,a,o,md5(r),l,x())}m()}let i=p("#mp-nick").value,r=p("#mp-mail").value,s=p("#mp-website").value,a=p("#mp-comment").innerText.replace(/\n|\n\r|\r/g,"<br>"),l=[],x=function(){let e=p(".mixxo-post"),t=p("#mp-comment"),o=p("#mp-success-tips"),n=p(".mp-reply-tips"),m=p("#mp-comment + label > span");"reply"===e.getAttribute("type")&&(e.setAttribute("type","comment"),e.classList.remove("mixxo-post-reply"),p("#mp-overlay").classList.remove("mp-overlay"),n.style.display="",n.innerHTML=""),t.innerText="",m.innerText=2e3,o.classList.add("mp-success-tips"),localStorage.setItem("mixxoPostCache",'{"nick":"'+i+'","mail":"'+r+'","website":"'+s+'"}')};switch(!0){case""===i:p("#mp-nick").focus();break;case""===r:p("#mp-mail").focus();break;case""===a:p("#mp-comment").focus();break;default:i===n?!0===u.getCurrentUser()?t():(function(e,t,o){i===n&&AV.User.logIn(t,o).then(e=>{localStorage.removeItem("mixxoPostCache"),u.init(),console.log("登录成功"),p("#mp-mail").value="",p("#mp-website").value=""},e=>{})}(0,r,s),d(!0)):t()}})}()};return e}(window.mixxoPost||{});