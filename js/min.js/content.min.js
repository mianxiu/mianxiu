function logo_other(){$("#logo_other").addEventListener("click",()=>{$("html").classList.remove("html-color"),$("#rule").innerHTML="",$("#index").style.display="block",$("#background-box").style.display="block",$("#logo_other").style.display="",mp3PlayerType("normal"),navHidden("off"),triangle()})}function navGetAjax(){$("#navigation ul").addEventListener("click",function(e){if("A"===e.target.tagName){for(let e of $All("#navigation a"))e.className="";e.target.className="nav-active";let t=e.target.innerText.toLowerCase();$("#rule").dataset.id=t,"home"===t?writeContent():ajax(t+"/index.html",writeContent)}})}function essayAjax(){let e=0;$("#essayLeft").addEventListener("click",t=>{if("H1"===t.target.tagName){e=document.documentElement.scrollTop;let l=t.target.parentNode,a=l.children[2].innerText,n=new Date(l.children[0].innerText),o=n.getFullYear()+"/"+(n.getMonth()<10?"0"+(Number(n.getMonth())+1):Number(n.getMonth())+1)+"/"+(n.getDate()<10?"0"+n.getDate():n.getDate());ajax("./essay/"+o+"/"+encodeURI(a)+"/context.html",writeEssay);let s={name:"essayContext",scrollTop:document.documentElement.scrollTop,type:"forward"};history.pushState(s,a,"./essay/"+o+"/"+a+"/")}}),$("#pages").addEventListener("click",e=>{if("LI"===e.target.tagName){let l="./essay/pages/"+e.target.innerText+"/index.html";ajax(l,t);let a=$("#pages").childNodes[1].children;for(let e=0;e<a.length;e++)a[e].className="";e.target.className="onPage"}});let t=function(){$("#essayLeft > ul").innerHTML=this.responseText,document.documentElement.scrollTop=0}}function gallery_overlay(){$("#gallery").addEventListener("mouseenter",()=>{for(let e=0;e<$All(".gallery-link").length;e++)$All(".gallery-link")[e].addEventListener("mouseenter",e=>{e.target.children[0].style.display="block"}),$All(".gallery-link")[e].addEventListener("mouseleave",e=>{e.target.children[0].style.display="none"})})}function gallery_tag(){let e,t=$(".gallery-toggle-tags"),l=function(e){for(let t of $All(".gallery-link"))new RegExp(e,"gm").test(t.getAttribute("data-tag"))||t.classList.add("gallery-none");new RegExp(e,"gm").test(t.getAttribute("data-toggle-tag"))||($("#gallery").style.transform="translateY(.5rem)",t.innerHTML+='<span class="toggle-tag">'+e.replace(/#/,"")+"</span>",t.setAttribute("data-toggle-tag",t.getAttribute("data-toggle-tag")+e))};for(let t of $All(".gallery-link"))t.addEventListener("click",t=>{if(e=window.location.scrollTop,"gallery-tag"===t.target.className)l(t.target.innerText);else if("EM"===t.target.tagName)l(t.target.parentNode.innerText);else if(/gallery-overlay|gallery-title|gallery-description|gallery-tags/gm.test(t.target.className)){let e=/gallery-title|gallery-description|gallery-tags/gm.test(t.target.className)?t.target.parentNode.parentNode.getAttribute("data-href"):t.target.parentNode.getAttribute("data-href"),l={name:"galleryContext",scrollTop:document.documentElement.scrollTop};ajax(e+"/context.html",function(t){$("#galleryContext > div").innerHTML+=this.responseText,$("title").innerText=e.split("/").pop()+" | Mianxiu's Blog..."}),$("#gallery").style.display="none",$("#logo_other").style.display="none",history.pushState(l,null,e+"/"),document.documentElement.scrollTop=0}});t.addEventListener("click",e=>{if("toggle-tag"===e.target.className){t.setAttribute("data-toggle-tag",t.getAttribute("data-toggle-tag").replace(new RegExp("#"+e.target.innerText,"gm"),""));for(let e of $All(".gallery-link"))(new RegExp(t.getAttribute("data-toggle-tag"),"gm").test(e.getAttribute("data-tag"))||"undefined"===t.getAttribute("data-toggle-tag"))&&e.classList.remove("gallery-none");e.target.remove(),""===t.getAttribute("data-toggle-tag")&&($("#gallery").style="")}})}let htmlFontSize=parseInt(getComputedStyle($("html"),null).getPropertyValue("font-size").replace("px")),historylength="";listenEassyClose=function(){$("#essayClose").addEventListener("click",function(){console.log("close"),""!==historylength?history.go(historylength-history.length-2):history.go(-1)},!1)};let writeContent=function(){console.log("DONE",this.status),void 0===this.responseText?$("#rule").innerHTML="":$("#rule").innerHTML=this.responseText;let e=function(e){switch(e){case"on":$("#index").style.display="none",$("#logo_other").style.display="block",$("#allContext").style.marginTop="1.2rem",$("#background-box").style.display="none",mp3PlayerType("min"),navHidden("on");break;case"off":$("#index").style.display="block",mp3PlayerType("normal"),navHidden("off")}},t=$("#rule").dataset.id,l={name:t};switch(t){case"home":e("off"),triangle();break;case"gallery":$("html").classList.add("html-color"),e("on"),gallery_overlay(),gallery_tag(),history.pushState(l,"","");break;case"essay":e("on"),essayAjax(),history.pushState(l,"","")}},writeEssay=function(){document.documentElement.scrollTop=0,$("#essay").style.display="none",$("#essayText").style="height:100vh;width:100vw;",$("#navigation").style.filter="blur(0.04rem)",$("#essayText>div").innerHTML=this.responseText,$("#essayClose").style.transform="scale(1,1)",$("#main").style="display:flex;justify-content:center;height:100vh;",$("title").innerText=decodeURI(window.location.href.split(/\//)[7])+" | Mianxiu's blog",$("#logo_other").style.display="none";for(let e of document.querySelectorAll("pre"))hljs.highlightBlock(e);mixxoPost.init({appId:"N8ILsvPRQiKpIOlRETRw0ShQ-gzGzoHsz",appKey:"hp80QRKBtn8fT48ImaCJxqFE",adminNick:"mianxiu",md5CDN:"",gravatarCDN:""})};history.pushState({name:"home"},"",""),window.addEventListener("popstate",e=>{if(null!==history.state)switch(history.state.name){case"home":case"essay":$("#essayClose").style.transform="",$("#essay").style.display="",$("#essayText").style="",$("#navigation").style.filter="blur(0px)",$("#essayText>div").innerHTML="",$("#main").style="",$("title").innerText="Mianxiu's blog",$("#logo_other").style.display="",$("html").classList.remove("html-color"),document.documentElement.scrollTop=history.state.scrollTop;break;case"gallery":$("#gallery").style.display="",$("#galleryContext > div").innerHTML="",$("#logo_other").style.display="",document.documentElement.scrollTop=history.state.scrollTop,$("title").innerText="Mianxiu's Blog...",$("html").classList.add("html-color");break;case"essayContext":ajax(window.location.href+"/context.html",writeEssay);break;case"galleryContext":ajax(window.location.href+"/context.html",function(){$("#galleryContext > div").innerHTML+=this.responseText}),$("#gallery").style.display="none",$("#logo_other").style.display="none",document.documentElement.scrollTop=0,$("title").innerText=decodeURI(window.location.href.slice(0,-1).split("/").pop())+" | Mianxiu's Blog..."}else/#fn/g.test(window.location.href)&&(console.log("fn-don't"+historylength),""===historylength&&(historylength=history.length))});